<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/h3-js@4.1.0/dist/h3-js.umd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""></script>
      <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@latest/dist/leaflet.draw.css" />
    <script src="https://unpkg.com/leaflet-draw@latest/dist/leaflet.draw.js"></script>
  </head>
  <body>
    hej
    <div id='map' style='width: 100%; height: 50vh;'></div>

    <input type="range" min="0" max="15" step="1" value="7" />
    <input type="number" min="0" max="15" step="1" value="7" />

    <script>
      let resolution = 7
      let rings = []

      const number = document.querySelector("input[type=number]")
      const range = document.querySelector("input[type=range]")
      number.addEventListener('input', updateResolution)
      range.addEventListener('change', updateResolution)
      range.addEventListener('input', ({ target }) => {
        number.value = parseInt(target.value, 10)
      })

      function updateResolution({ target }) {
        resolution = clamp(0, target.value, 15)
        number.value = parseInt(resolution, 10)
        range.value = parseInt(resolution, 10)
        update()
      }

      function addRing(layer) {
        rings.push(layer)
        update()
      }

      function update() {
        drawnItems.clearLayers();
        rings.forEach(layer => {
          drawnItems.addLayer(layer)
          const cells = h3.polygonToCells(layer.toGeoJSON().geometry.coordinates, resolution)
          const coordinates = h3.cellsToMultiPolygon(cells)
          drawnItems.addLayer(L.geoJSON({ type: "MultiPolygon", coordinates }))
        })
      }

      // --- leaflet ----

      const map = L.map('map', { drawControl: true }).setView([51.505, -0.09], 13)

      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' })
       .addTo(map);

      const drawnItems = L.featureGroup().addTo(map)

      map.on(L.Draw.Event.CREATED, function ({ layer }) {
        addRing(layer)
      });

      // --- utils ---

      function clamp(min, value, max) {
        return Math.max(min, Math.min(max, value))
      }
    </script>
  </body>
</html>